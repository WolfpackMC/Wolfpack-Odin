kind: pipeline
type: docker
name: packmaker

workspace:
  path: /drone/src

steps:
- name: pre-lock
  image: python:3
  commands:
  - apt update
  - apt -y install zip neofetch
  - neofetch
  - python3 -VVV
  - curl -L 'https://get.kalka.io/curseforge.db' > curseforge.db
  - git clone https://git.kalka.io/kalka/wolfpackmaker
- name: lock
  image: python:3
  commands:
  - python3 wolfpackmaker/util/lock.py
- name: package
  image: python:3
  commands:
  - zip -r Wolfpack-Odin.zip wolfpackmaker/wolfpackmaker.py wolfpackmaker/wolfpackmaker.bat wolfpackmaker/requirements.txt wolfpackmaker/multimc.bat .minecraft instance.cfg mmc-pack.json wolfpackodin.png
  - zip -r config.zip .minecraft mmc-pack.json
- name: mod-list
  image: python:3
  commands:
  - python3 wolfpackmaker/raw_mod_list.py Odin
- name: upload
  image: plugins/gitea-release
  settings:
    api_key:
      from_secret: api_key
    base_url: https://git.kalka.io
    title: ${DRONE_TAG}
    note: ${DRONE_COMMIT_MESSAGE}
    files:
      - Wolfpack-Odin.zip
      - config.zip
      - manifest.lock
      - modlist.db
  when:
    event: tag

    